<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ› æ–‡ä»¶ä¸Šä¼ è°ƒè¯•é¡µé¢</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .debug-panel {
            background: #1e293b;
            color: #f8fafc;
            padding: 1rem;
            border-radius: 8px;
            font-family: monospace;
            margin: 1rem 0;
            max-height: 300px;
            overflow-y: auto;
        }
        .test-btn {
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            background: #2563eb;
            color: white;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #1d4ed8;
        }
    </style>
</head>
<body>
    <div style="padding: 2rem; max-width: 1000px; margin: 0 auto;">
        <h1>ğŸ› æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½è°ƒè¯•</h1>
        
        <!-- è°ƒè¯•æ§åˆ¶å° -->
        <div class="debug-panel" id="debug-console">
            [ç³»ç»Ÿ] è°ƒè¯•æ§åˆ¶å°å¯åŠ¨...<br>
        </div>
        
        <!-- æµ‹è¯•æŒ‰é’® -->
        <div style="margin: 1rem 0;">
            <button class="test-btn" onclick="testElements()">ğŸ” æ£€æŸ¥DOMå…ƒç´ </button>
            <button class="test-btn" onclick="testEventListeners()">ğŸ§ æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨</button>
            <button class="test-btn" onclick="testCurrentFiles()">ğŸ“ æ£€æŸ¥æ–‡ä»¶çŠ¶æ€</button>
            <button class="test-btn" onclick="clearDebug()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-card" style="margin: 2rem 0;">
            <h3>ğŸ“ æ–‡ä»¶ä¸Šä¼ æµ‹è¯•åŒºåŸŸ</h3>
            
            <div class="drag-drop-area" id="drag-drop-area">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <p class="upload-hint">æ”¯æŒæ‰€æœ‰æ–‡ä»¶ç±»å‹ï¼ˆæµ‹è¯•ç”¨ï¼‰</p>
                <input type="file" id="file-input" multiple>
            </div>
            
            <button class="btn btn-primary" onclick="testUpload()" style="margin-top: 1rem;">
                <i class="fas fa-upload"></i> æµ‹è¯•ä¸Šä¼ ï¼ˆæ¨¡æ‹Ÿï¼‰
            </button>
        </div>
        
        <!-- æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º -->
        <div id="file-info" style="background: #f8fafc; padding: 1rem; border-radius: 8px; margin: 1rem 0;">
            <h4>å½“å‰é€‰æ‹©çš„æ–‡ä»¶ï¼š</h4>
            <div id="file-list">æ— </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentFiles = [];
        let debugConsole = document.getElementById('debug-console');
        
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#60a5fa',
                success: '#34d399', 
                error: '#f87171',
                warning: '#fbbf24'
            };
            
            debugConsole.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span><br>`;
            debugConsole.scrollTop = debugConsole.scrollHeight;
            console.log(`[DEBUG] ${message}`);
        }
        
        // æµ‹è¯•DOMå…ƒç´ 
        function testElements() {
            debugLog('ğŸ” å¼€å§‹æ£€æŸ¥DOMå…ƒç´ ...', 'info');
            
            const dragDropArea = document.getElementById('drag-drop-area');
            const fileInput = document.getElementById('file-input');
            
            debugLog(`drag-drop-area: ${!!dragDropArea ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}`, dragDropArea ? 'success' : 'error');
            debugLog(`file-input: ${!!fileInput ? 'âœ… æ‰¾åˆ°' : 'âŒ æœªæ‰¾åˆ°'}`, fileInput ? 'success' : 'error');
            
            if (dragDropArea) {
                debugLog(`æ‹–æ‹½åŒºåŸŸå¯è§æ€§: ${dragDropArea.offsetParent !== null ? 'âœ… å¯è§' : 'âŒ éšè—'}`, dragDropArea.offsetParent !== null ? 'success' : 'warning');
            }
            
            if (fileInput) {
                debugLog(`æ–‡ä»¶è¾“å…¥æ¡†å¯è§æ€§: ${fileInput.offsetParent !== null ? 'âœ… å¯è§' : 'âŒ éšè—'}`, fileInput.offsetParent !== null ? 'success' : 'warning');
            }
        }
        
        // æµ‹è¯•äº‹ä»¶ç›‘å¬å™¨
        function testEventListeners() {
            debugLog('ğŸ§ å¼€å§‹è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...', 'info');
            setupFileUploadListeners();
            debugLog('âœ… äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ', 'success');
        }
        
        // æ£€æŸ¥æ–‡ä»¶çŠ¶æ€
        function testCurrentFiles() {
            debugLog('ğŸ“ æ£€æŸ¥å½“å‰æ–‡ä»¶çŠ¶æ€...', 'info');
            debugLog(`currentFilesç±»å‹: ${typeof currentFiles}`, 'info');
            debugLog(`currentFilesæ˜¯å¦ä¸ºæ•°ç»„: ${Array.isArray(currentFiles)}`, 'info');
            debugLog(`currentFilesé•¿åº¦: ${currentFiles.length}`, 'info');
            
            if (currentFiles.length > 0) {
                currentFiles.forEach((file, index) => {
                    debugLog(`æ–‡ä»¶${index + 1}: ${file.name} (${file.size} bytes)`, 'success');
                });
            } else {
                debugLog('âŒ æ²¡æœ‰é€‰æ‹©ä»»ä½•æ–‡ä»¶', 'warning');
            }
        }
        
        // æ¨¡æ‹Ÿä¸Šä¼ æµ‹è¯•
        function testUpload() {
            debugLog('ğŸš€ æ¨¡æ‹Ÿä¸Šä¼ æµ‹è¯•...', 'info');
            
            if (currentFiles.length === 0) {
                debugLog('âŒ æ²¡æœ‰æ–‡ä»¶å¯ä¸Šä¼ ', 'error');
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'warning');
                return;
            }
            
            debugLog(`âœ… å‘ç° ${currentFiles.length} ä¸ªæ–‡ä»¶ï¼Œå¼€å§‹æ¨¡æ‹Ÿä¸Šä¼ ...`, 'success');
            showToast(`æ¨¡æ‹Ÿä¸Šä¼  ${currentFiles.length} ä¸ªæ–‡ä»¶æˆåŠŸï¼`, 'success');
        }
        
        // æ¸…ç©ºè°ƒè¯•æ—¥å¿—
        function clearDebug() {
            debugConsole.innerHTML = '[ç³»ç»Ÿ] è°ƒè¯•æ§åˆ¶å°å·²æ¸…ç©º...<br>';
        }
        
        // æ–‡ä»¶å¤„ç†å‡½æ•°
        function handleFileSelect(files) {
            debugLog('=== ğŸ¯ handleFileSelectè¢«è°ƒç”¨ ===', 'info');
            debugLog(`ä¼ å…¥æ–‡ä»¶æ•°é‡: ${files.length}`, 'info');
            
            currentFiles = Array.from(files);
            
            // æ›´æ–°æ–‡ä»¶ä¿¡æ¯æ˜¾ç¤º
            const fileList = document.getElementById('file-list');
            if (currentFiles.length > 0) {
                fileList.innerHTML = currentFiles.map(file => 
                    `<div>ğŸ“„ ${file.name} (${formatFileSize(file.size)})</div>`
                ).join('');
                
                debugLog(`âœ… æˆåŠŸé€‰æ‹© ${currentFiles.length} ä¸ªæ–‡ä»¶`, 'success');
            } else {
                fileList.innerHTML = 'æ— ';
                debugLog('âŒ æ²¡æœ‰æœ‰æ•ˆæ–‡ä»¶', 'error');
            }
        }
        
        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Toastæç¤ºå‡½æ•°
        function showToast(message, type = 'info') {
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; cursor: pointer; color: #64748b; font-size: 1.2rem; padding: 0 5px;">Ã—</button>
                </div>
            `;
            
            container.appendChild(toast);
            debugLog(`ğŸ“¨ Toastæ¶ˆæ¯: ${message}`, 'info');
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ç›‘å¬å™¨ï¼ˆå¤åˆ¶è‡ªä¸»æ–‡ä»¶ï¼‰
        function setupFileUploadListeners() {
            debugLog('=== è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ç›‘å¬å™¨ ===', 'info');
            
            const dragDropArea = document.getElementById('drag-drop-area');
            const fileInput = document.getElementById('file-input');

            if (!dragDropArea || !fileInput) {
                debugLog('âŒ æ–‡ä»¶ä¸Šä¼ å…ƒç´ æœªæ‰¾åˆ°!', 'error');
                return;
            }

            // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨
            const newDragDropArea = dragDropArea.cloneNode(true);
            const newFileInput = newDragDropArea.querySelector('#file-input');
            dragDropArea.parentNode.replaceChild(newDragDropArea, dragDropArea);

            debugLog('âœ… å¼€å§‹ç»‘å®šäº‹ä»¶ç›‘å¬å™¨...', 'info');

            // æ‹–æ‹½äº‹ä»¶
            newDragDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                newDragDropArea.classList.add('dragover');
                debugLog('ğŸ”„ æ–‡ä»¶æ‹–æ‹½æ‚¬åœ', 'info');
            });

            newDragDropArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                if (!newDragDropArea.contains(e.relatedTarget)) {
                    newDragDropArea.classList.remove('dragover');
                    debugLog('ğŸ”„ æ–‡ä»¶æ‹–æ‹½ç¦»å¼€', 'info');
                }
            });

            newDragDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                newDragDropArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                debugLog(`ğŸ¯ æ‹–æ‹½æ”¾ä¸‹ ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`é€šè¿‡æ‹–æ‹½é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });

            // ç‚¹å‡»äº‹ä»¶
            newDragDropArea.addEventListener('click', (e) => {
                debugLog('ğŸ–±ï¸ ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ', 'info');
                if (e.target !== newFileInput) {
                    newFileInput.click();
                }
            });

            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            newFileInput.addEventListener('change', (e) => {
                const files = e.target.files;
                debugLog(`ğŸ¯ æ–‡ä»¶é€‰æ‹©æ”¹å˜: ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });

            debugLog('âœ… äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ', 'success');
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...', 'info');
            testElements();
            setupFileUploadListeners();
            debugLog('âœ… åˆå§‹åŒ–å®Œæˆ', 'success');
        });
    </script>
</body>
</html> 