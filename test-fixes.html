<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½ä¿®å¤æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
        <h1>ğŸ”§ åŠŸèƒ½ä¿®å¤æµ‹è¯•é¡µé¢</h1>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
            <!-- æ–‡ä»¶ä¸Šä¼ æµ‹è¯• -->
            <div class="upload-card">
                <h3><i class="fas fa-file-upload"></i> æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æµ‹è¯•</h3>
                
                <div class="drag-drop-area" id="drag-drop-area">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <p class="upload-hint">æ”¯æŒ Excel, CSV, PDF, Word, æ–‡æœ¬æ–‡ä»¶</p>
                    <input type="file" id="file-input" multiple accept=".xlsx,.xls,.csv,.pdf,.docx,.doc,.txt,.md">
                </div>
                
                <button class="btn btn-primary" onclick="testUpload()" style="margin-top: 1rem;">
                    <i class="fas fa-upload"></i> æµ‹è¯•ä¸Šä¼ åé¦ˆ
                </button>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                    <h4>æµ‹è¯•æ­¥éª¤ï¼š</h4>
                    <ol>
                        <li>ç‚¹å‡»ä¸Šä¼ åŒºåŸŸé€‰æ‹©æ–‡ä»¶</li>
                        <li>æˆ–è€…æ‹–æ‹½æ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ</li>
                        <li>è§‚å¯Ÿæ˜¯å¦æœ‰Toastæ¶ˆæ¯æç¤º</li>
                        <li>è§‚å¯Ÿä¸Šä¼ åŒºåŸŸæ˜¯å¦å˜è‰²</li>
                        <li>è§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶å</li>
                    </ol>
                </div>
            </div>

            <!-- åµŒå…¥æ¨¡å‹é…ç½®æµ‹è¯• -->
            <div class="config-card">
                <h3><i class="fas fa-vector-square"></i> åµŒå…¥æ¨¡å‹é…ç½®æµ‹è¯•</h3>
                
                <div class="form-group">
                    <label for="test-embed-type">æ¨¡å‹ç±»å‹</label>
                    <select id="test-embed-type" class="form-control" onchange="testToggleDisplay()">
                        <option value="sentence-transformers">SentenceTransformers</option>
                        <option value="openai">OpenAI Embeddings</option>
                        <option value="local-api" selected>æœ¬åœ°API (OpenAIå…¼å®¹)</option>
                    </select>
                </div>
                
                <div class="form-group" id="test-embed-url-group">
                    <label for="test-embed-url">APIåœ°å€</label>
                    <input type="text" id="test-embed-url" class="form-control" 
                           value="http://192.168.22.191:8000/v1" placeholder="åµŒå…¥æ¨¡å‹APIåœ°å€">
                </div>
                
                <div class="form-group" id="test-embed-key-group">
                    <label for="test-embed-key">APIå¯†é’¥</label>
                    <input type="password" id="test-embed-key" class="form-control" 
                           value="EMPTY" placeholder="API Key (å¯é€‰)">
                </div>
                
                <div class="form-group">
                    <label for="test-embed-model">æ¨¡å‹åç§°</label>
                    <input type="text" id="test-embed-model" class="form-control" 
                           value="auto" placeholder="åµŒå…¥æ¨¡å‹åç§°">
                </div>
                
                <div class="form-group">
                    <label for="test-embed-dim">å‘é‡ç»´åº¦</label>
                    <input type="number" id="test-embed-dim" class="form-control" 
                           value="4096" placeholder="å‘é‡ç»´åº¦">
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: #f8fafc; border-radius: 8px;">
                    <h4>æµ‹è¯•æ­¥éª¤ï¼š</h4>
                    <ol>
                        <li>åˆ‡æ¢æ¨¡å‹ç±»å‹é€‰æ‹©æ¡†</li>
                        <li>è§‚å¯ŸAPIåœ°å€å’Œå¯†é’¥å­—æ®µæ˜¯å¦æ­£ç¡®æ˜¾ç¤º/éšè—</li>
                        <li>local-api å’Œ openai åº”è¯¥æ˜¾ç¤ºå…¨éƒ¨å­—æ®µ</li>
                        <li>sentence-transformers åº”è¯¥éšè—APIå­—æ®µ</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
        <div style="margin-top: 2rem; padding: 1.5rem; background: white; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3><i class="fas fa-clipboard-check"></i> æµ‹è¯•ç»“æœ</h3>
            <div id="test-results" style="font-family: monospace; background: #f1f5f9; padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                ç­‰å¾…æµ‹è¯•ç»“æœ...
            </div>
        </div>
    </div>

    <script>
        // ç®€åŒ–çš„æµ‹è¯•è„šæœ¬
        let currentFiles = [];
        
        function testToggleDisplay() {
            const embedType = document.getElementById('test-embed-type');
            const urlGroup = document.getElementById('test-embed-url-group');
            const keyGroup = document.getElementById('test-embed-key-group');
            
            const selectedType = embedType.value;
            console.log('æµ‹è¯•åµŒå…¥æ¨¡å‹ç±»å‹åˆ‡æ¢:', selectedType);
            
            if (selectedType === 'openai' || selectedType === 'local-api') {
                urlGroup.style.display = 'block';
                keyGroup.style.display = 'block';
                updateTestResults(`âœ… åˆ‡æ¢åˆ° ${selectedType}ï¼ŒAPIå­—æ®µå·²æ˜¾ç¤º`);
            } else {
                urlGroup.style.display = 'none';
                keyGroup.style.display = 'none';
                updateTestResults(`âœ… åˆ‡æ¢åˆ° ${selectedType}ï¼ŒAPIå­—æ®µå·²éšè—`);
            }
        }
        
        function testUpload() {
            if (currentFiles.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ä»¶è¿›è¡Œæµ‹è¯•', 'warning');
                updateTestResults('âŒ æ²¡æœ‰é€‰æ‹©æ–‡ä»¶');
            } else {
                showToast('æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æµ‹è¯•æˆåŠŸï¼', 'success');
                updateTestResults(`âœ… æ–‡ä»¶ä¸Šä¼ æµ‹è¯•æˆåŠŸï¼Œå·²é€‰æ‹© ${currentFiles.length} ä¸ªæ–‡ä»¶`);
            }
        }
        
        function updateTestResults(message) {
            const results = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            results.innerHTML += `[${timestamp}] ${message}\n`;
            results.scrollTop = results.scrollHeight;
        }
        
        function handleFileSelect(files) {
            currentFiles = Array.from(files);
            updateFilePreview();
            updateTestResults(`âœ… æ–‡ä»¶é€‰æ‹©æˆåŠŸ: ${currentFiles.map(f => f.name).join(', ')}`);
        }

        function updateFilePreview() {
            const dragDropArea = document.getElementById('drag-drop-area');
            const preview = dragDropArea.querySelector('p');
            
            if (currentFiles.length > 0) {
                const fileNames = currentFiles.map(f => f.name).join(', ');
                preview.innerHTML = `å·²é€‰æ‹© ${currentFiles.length} ä¸ªæ–‡ä»¶:<br><small style="color: #666;">${fileNames}</small>`;
                dragDropArea.style.borderColor = '#10b981';
                dragDropArea.style.backgroundColor = 'rgba(16, 185, 129, 0.05)';
            } else {
                preview.innerHTML = 'æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶<br><span class="upload-hint">æ”¯æŒ Excel, CSV, PDF, Word, æ–‡æœ¬æ–‡ä»¶</span>';
                dragDropArea.style.borderColor = '';
                dragDropArea.style.backgroundColor = '';
            }
        }
        
        function showToast(message, type = 'info') {
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; cursor: pointer; color: #64748b; font-size: 1.2rem; padding: 0 5px;">Ã—</button>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // åˆå§‹åŒ–æ–‡ä»¶ä¸Šä¼ äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            const dragDropArea = document.getElementById('drag-drop-area');
            const fileInput = document.getElementById('file-input');

            // æ‹–æ‹½äº‹ä»¶
            dragDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dragDropArea.classList.add('dragover');
            });

            dragDropArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                if (!dragDropArea.contains(e.relatedTarget)) {
                    dragDropArea.classList.remove('dragover');
                }
            });

            dragDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dragDropArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`é€šè¿‡æ‹–æ‹½é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });

            // ç‚¹å‡»äº‹ä»¶
            dragDropArea.addEventListener('click', (e) => {
                if (e.target !== fileInput) {
                    fileInput.click();
                }
            });

            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });
            
            // åˆå§‹åŒ–åµŒå…¥æ¨¡å‹é…ç½®æ˜¾ç¤º
            testToggleDisplay();
            updateTestResults('ğŸš€ æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html> 