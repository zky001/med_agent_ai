<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿåç«¯ï¼‰</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .mock-status {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            color: #92400e;
        }
        .test-result {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div style="padding: 2rem; max-width: 1000px; margin: 0 auto;">
        <h1>ğŸ§ª æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æµ‹è¯•ï¼ˆæ¨¡æ‹Ÿåç«¯ï¼‰</h1>
        
        <div class="mock-status">
            âš ï¸ <strong>æ³¨æ„ï¼š</strong>è¿™ä¸ªé¡µé¢ä½¿ç”¨æ¨¡æ‹Ÿçš„åç«¯APIæ¥æµ‹è¯•å‰ç«¯åŠŸèƒ½ã€‚æ–‡ä»¶ä¸ä¼šçœŸæ­£ä¸Šä¼ ï¼Œä½†å¯ä»¥éªŒè¯å‰ç«¯é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚
        </div>
        
        <!-- æ–‡ä»¶ä¸Šä¼ åŒºåŸŸ -->
        <div class="upload-card">
            <h3>ğŸ“ æ–‡ä»¶ä¸Šä¼ æµ‹è¯•</h3>
            
            <div class="form-group">
                <label for="kb-type">çŸ¥è¯†åº“åˆ†ç±»</label>
                <select id="kb-type" class="form-select">
                    <option value="ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£">ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£</option>
                    <option value="ä¸´åºŠè¯•éªŒæ–¹æ¡ˆ">ä¸´åºŠè¯•éªŒæ–¹æ¡ˆ</option>
                    <option value="åŒ»å­¦æ–‡çŒ®">åŒ»å­¦æ–‡çŒ®</option>
                </select>
            </div>
            
            <div class="drag-drop-area" id="drag-drop-area">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <p>æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                <p class="upload-hint">æ”¯æŒ Excel, CSV, PDF, Word, æ–‡æœ¬æ–‡ä»¶</p>
                <input type="file" id="file-input" multiple>
            </div>
            
            <button class="btn btn-primary" onclick="uploadFiles()" style="margin-top: 1rem;">
                <i class="fas fa-upload"></i> å¼€å§‹ä¸Šä¼ 
            </button>
        </div>
        
        <!-- æµ‹è¯•ç»“æœæ˜¾ç¤º -->
        <div class="test-result" id="test-results">
            <h4>ğŸ“Š æµ‹è¯•ç»“æœ</h4>
            <div id="results-content">ç­‰å¾…æ–‡ä»¶ä¸Šä¼ ...</div>
        </div>
        
        <!-- æ¨¡æ‹Ÿçš„ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="test-result">
            <h4>ğŸ“ˆ æ¨¡æ‹Ÿç»Ÿè®¡ä¿¡æ¯</h4>
            <div id="mock-stats">
                <div>ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£: <span id="user-docs-count">0</span> ä¸ª</div>
                <div>æ€»æ–‡æ¡£æ•°: <span id="total-docs-count">34</span> ä¸ª</div>
            </div>
        </div>
        
        <!-- æ¨¡æ‹Ÿçš„æ–‡ä»¶åˆ—è¡¨ -->
        <div class="test-result">
            <h4>ğŸ“‹ æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨</h4>
            <div id="mock-file-list">æš‚æ— æ–‡ä»¶</div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿå…¨å±€å˜é‡
        let currentFiles = [];
        let mockUploadedFiles = [];
        let mockUserDocsCount = 0;
        
        // æ¨¡æ‹ŸAPIåŸºç¡€URL
        const API_BASE_URL = 'http://localhost:8000';
        
        // æ–‡ä»¶å¤„ç†å‡½æ•°
        function handleFileSelect(files) {
            console.log('=== ğŸ¯ handleFileSelectè¢«è°ƒç”¨ ===');
            console.log(`ä¼ å…¥æ–‡ä»¶æ•°é‡: ${files.length}`);
            
            currentFiles = Array.from(files);
            updateFilePreview();
            updateTestResults('æ–‡ä»¶é€‰æ‹©', `âœ… å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`);
            
            // æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…
            const fileDetails = currentFiles.map(file => 
                `ğŸ“„ ${file.name} (${formatFileSize(file.size)})`
            ).join('<br>');
            
            updateTestResults('æ–‡ä»¶è¯¦æƒ…', fileDetails);
        }
        
        function updateFilePreview() {
            const dragDropArea = document.getElementById('drag-drop-area');
            const preview = dragDropArea.querySelector('p');
            
            if (currentFiles.length > 0) {
                const fileNames = currentFiles.map(f => f.name).join(', ');
                preview.innerHTML = `å·²é€‰æ‹© ${currentFiles.length} ä¸ªæ–‡ä»¶:<br><small style="color: #666;">${fileNames}</small>`;
                
                dragDropArea.style.borderColor = '#10b981';
                dragDropArea.style.backgroundColor = 'rgba(16, 185, 129, 0.05)';
            } else {
                preview.innerHTML = 'æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶<br><span class="upload-hint">æ”¯æŒ Excel, CSV, PDF, Word, æ–‡æœ¬æ–‡ä»¶</span>';
                dragDropArea.style.borderColor = '';
                dragDropArea.style.backgroundColor = '';
            }
        }
        
        // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ 
        async function uploadFiles() {
            console.log('=== ğŸš€ uploadFilesè¢«è°ƒç”¨ ===');
            
            if (currentFiles.length === 0) {
                showToast('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'warning');
                updateTestResults('ä¸Šä¼ å¤±è´¥', 'âŒ æ²¡æœ‰é€‰æ‹©æ–‡ä»¶');
                return;
            }
            
            const uploadBtn = document.querySelector('.btn-primary');
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨ä¸Šä¼ ...';
            
            updateTestResults('ä¸Šä¼ å¼€å§‹', `ğŸš€ å¼€å§‹æ¨¡æ‹Ÿä¸Šä¼  ${currentFiles.length} ä¸ªæ–‡ä»¶...`);
            
            try {
                // æ¨¡æ‹Ÿä¸Šä¼ å»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                let successCount = 0;
                
                for (let file of currentFiles) {
                    // æ¨¡æ‹Ÿæ–‡ä»¶ä¸Šä¼ æˆåŠŸ
                    const mockFileInfo = {
                        filename: file.name,
                        size: file.size,
                        modified: Date.now() / 1000,
                        upload_time: new Date().toISOString()
                    };
                    
                    mockUploadedFiles.push(mockFileInfo);
                    successCount++;
                    
                    const recordsAdded = Math.max(1, Math.floor(file.size / 10000));
                    showToast(`æ–‡ä»¶ ${file.name} ä¸Šä¼ æˆåŠŸï¼Œæ·»åŠ äº† ${recordsAdded} æ¡è®°å½•`, 'success');
                }
                
                // æ›´æ–°ç»Ÿè®¡
                mockUserDocsCount += successCount;
                document.getElementById('user-docs-count').textContent = mockUserDocsCount;
                document.getElementById('total-docs-count').textContent = 34 + mockUserDocsCount;
                
                // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
                updateMockFileList();
                
                // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
                currentFiles = [];
                document.getElementById('file-input').value = '';
                updateFilePreview();
                
                showToast(`æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶`, 'success');
                updateTestResults('ä¸Šä¼ å®Œæˆ', `âœ… æˆåŠŸä¸Šä¼  ${successCount} ä¸ªæ–‡ä»¶`);
                
            } catch (error) {
                showToast('ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                updateTestResults('ä¸Šä¼ å¤±è´¥', `âŒ é”™è¯¯: ${error.message}`);
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.innerHTML = '<i class="fas fa-upload"></i> å¼€å§‹ä¸Šä¼ ';
            }
        }
        
        // æ›´æ–°æ¨¡æ‹Ÿæ–‡ä»¶åˆ—è¡¨
        function updateMockFileList() {
            const container = document.getElementById('mock-file-list');
            
            if (mockUploadedFiles.length === 0) {
                container.innerHTML = 'æš‚æ— æ–‡ä»¶';
                return;
            }
            
            container.innerHTML = mockUploadedFiles.map(file => `
                <div style="border-bottom: 1px solid #e2e8f0; padding: 0.5rem 0;">
                    ğŸ“„ ${file.filename} (${formatFileSize(file.size)})
                    <small style="color: #64748b; display: block;">
                        ä¸Šä¼ æ—¶é—´: ${new Date(file.upload_time).toLocaleString()}
                    </small>
                </div>
            `).join('');
        }
        
        // æ›´æ–°æµ‹è¯•ç»“æœ
        function updateTestResults(title, content) {
            const container = document.getElementById('results-content');
            const timestamp = new Date().toLocaleTimeString();
            
            container.innerHTML += `
                <div style="margin: 0.5rem 0; padding: 0.5rem; background: #f8fafc; border-radius: 4px;">
                    <strong>[${timestamp}] ${title}:</strong><br>
                    ${content}
                </div>
            `;
            container.scrollTop = container.scrollHeight;
        }
        
        // æ–‡ä»¶å¤§å°æ ¼å¼åŒ–
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // Toastæç¤º
        function showToast(message, type = 'info') {
            let container = document.getElementById('toast-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'toast-container';
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; cursor: pointer; color: #64748b; font-size: 1.2rem; padding: 0 5px;">Ã—</button>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 5000);
        }
        
        // è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ç›‘å¬å™¨
        function setupFileUploadListeners() {
            console.log('=== è®¾ç½®æ–‡ä»¶ä¸Šä¼ äº‹ä»¶ç›‘å¬å™¨ ===');
            
            const dragDropArea = document.getElementById('drag-drop-area');
            const fileInput = document.getElementById('file-input');

            if (!dragDropArea || !fileInput) {
                console.error('âŒ å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }

            // ç§»é™¤æ—§äº‹ä»¶ç›‘å¬å™¨
            const newDragDropArea = dragDropArea.cloneNode(true);
            const newFileInput = newDragDropArea.querySelector('#file-input');
            dragDropArea.parentNode.replaceChild(newDragDropArea, dragDropArea);

            // æ‹–æ‹½äº‹ä»¶
            newDragDropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                newDragDropArea.classList.add('dragover');
            });

            newDragDropArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                if (!newDragDropArea.contains(e.relatedTarget)) {
                    newDragDropArea.classList.remove('dragover');
                }
            });

            newDragDropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                newDragDropArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`é€šè¿‡æ‹–æ‹½é€‰æ‹©äº† ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });

            // ç‚¹å‡»äº‹ä»¶
            newDragDropArea.addEventListener('click', (e) => {
                if (e.target !== newFileInput) {
                    newFileInput.click();
                }
            });

            // æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            newFileInput.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files.length > 0) {
                    handleFileSelect(files);
                    showToast(`å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶`, 'success');
                }
            });

            console.log('âœ… äº‹ä»¶ç›‘å¬å™¨ç»‘å®šå®Œæˆ');
        }
        
        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ é¡µé¢åˆå§‹åŒ–...');
            setupFileUploadListeners();
            updateTestResults('é¡µé¢åˆå§‹åŒ–', 'âœ… é¡µé¢åŠ è½½å®Œæˆï¼Œäº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
        });
    </script>
</body>
</html> 